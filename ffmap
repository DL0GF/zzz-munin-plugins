#!/usr/bin/perl -w

use strict;
use warnings;

use Data::Dumper;
use JSON;
use LWP::Simple;

my $content = get('http://map.md.freifunk.net/nodes.json');
die 'Could not get it!' unless defined $content;

my $nodes_ref = decode_json($content);

#print Dumper( $nodes_ref->{'meta'} );

my $sum_clientcount  = 0;
my $node_count       = 0;
my $sum_online_nodes = 0;

foreach my $node ( @{ $nodes_ref->{'nodes'} } ) {
    if (!(     $node->{'flags'}->{'gateway'}
            || $node->{'flags'}->{'client'}
        )
        )
    {
        $node_count++;
        $sum_clientcount += $node->{'clientcount'};
        if ( $node->{'flags'}->{'online'} ) { $sum_online_nodes++ }
    }
}

print
    "${sum_online_nodes} of ${node_count} nodes online with ${sum_clientcount} clients\n";

# vim:ft=perl
